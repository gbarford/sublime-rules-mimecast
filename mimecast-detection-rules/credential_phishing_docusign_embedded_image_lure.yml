attack_types:
- Credential Phishing
description: Detects DocuSign phishing emails with no DocuSign links, a DocuSign logo
  embedded in the body of the message, from a new sender.
detection_methods:
- Computer Vision
- Content analysis
- Header analysis
- Natural Language Understanding
- Optical Character Recognition
- Sender analysis
id: dfe8715e-6318-579b-9131-ddfc9854dc95
name: 'Credential Phishing: DocuSign embedded image lure with no DocuSign domains
  in links'
severity: high
source: "type.inbound\nand length(attachments) <= 1\nand any(body.links,\n       \
  \ not strings.ilike(.href_url.domain.root_domain, \"docusign.*\")\n)\nand (\n  any(ml.logo_detect(beta.message_screenshot()).brands,\n\
  \      .name == \"DocuSign\"\n      or any(file.explode(beta.message_screenshot()),\n\
  \             strings.ilike(.scan.ocr.raw, \"*DocuSign*\")\n             and any(ml.nlu_classifier(.scan.ocr.raw).intents,\n\
  \                     .name == \"cred_theft\" and .confidence != \"low\"\n     \
  \        )\n      )\n  )\n)\nand any(file.explode(beta.message_screenshot()),\n\
  \        regex.icontains(.scan.ocr.raw,\n                        \"review document\"\
  ,\n                        \"[^d][^o][^c][^u]sign\",\n                        \"\
  important edocs\",\n                        \"completed document\",\n          \
  \              // German (Document (check|check|sign|sent))\n                  \
  \      \"Dokument (\xFCberpr\xFCfen|pr\xFCfen|unterschreiben|geschickt)\",\n   \
  \                     // German (important|urgent|immediate)\n                 \
  \       \"(wichtig|dringend|sofort)\"\n        )\n)\nand (\n  not profile.by_sender().solicited\n\
  \  or (\n    profile.by_sender().any_messages_malicious_or_spam\n    and not profile.by_sender().any_false_positives\n\
  \  )\n)\n// negate highly trusted sender domains unless they fail DMARC authentication\n\
  and\n(\n  (\n    sender.email.domain.root_domain in $high_trust_sender_root_domains\n\
  \    and (\n      any(distinct(headers.hops, .authentication_results.dmarc is not\
  \ null),\n          strings.ilike(.authentication_results.dmarc, \"*fail\")\n  \
  \    )\n    )\n  )\n  or sender.email.domain.root_domain not in $high_trust_sender_root_domains\n\
  )\n\n// negate legit replies\nand not (\n  length(headers.references) > 0\n  or\
  \ any(headers.hops, any(.fields, strings.ilike(.name, \"In-Reply-To\")))\n)\nand\
  \ not profile.by_sender().any_false_positives\n\n// negate docusign X-Return-Path\n\
  and not any(headers.hops,\n            .index == 0\n            and any(.fields,\n\
  \                    .name == \"X-Return-Path\"\n                    and strings.ends_with(.value,\
  \ \"docusign.net\")\n            )\n)"
tactics_and_techniques:
- 'Impersonation: Brand'
- Social engineering
tags:
- Mimecast Needs Fix
type: rule
